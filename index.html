<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JGA</title>
  
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
  <style>
    .hints {
      display: flex;
      flex-direction: row;
      gap: 5px;
    }
  </style>
</head>

<body>

<!-- <header>
<nav>
</nav>
</header> -->

<main>
  <h1 id="title"></h1>
  <p id="suggestion">Es ist sinnvoll die Antworten zu notieren</p>
  
  <article>
    <progress id="progress" max="100" value="70">10</progress>
    
    <form id="theForm">
      <div>
        <label id="question" for="answer">Tmp</label>
        <input id="answer" type="text" placeholder="Antwort" required>
        <label id="error" style="color: red"></label>
      </div>
      <div>
        <input id="submit" type="submit" value="Antworten">
      </div>
    </form>

    <section>
      <div id="hints" class="hints">
      </div>
      <label id="theHint" class="notice"></label>
    </section>
  </article>


  <button id="reset">Alles zurücksetzen</button>


</main>

<footer>
  <input type="date" id="theDate" value="2023-04-01">
</footer>


<script>
const data = [
  {
    id: "start", question: "(⚑ Seite 1) Wie ist der Name?",
    answerCorrect: (answer) => new RegExp('Fabian', 'i').test(answer),
    answerHint: (answer) => new RegExp('Pauline', 'i').test(answer)
            ? "Die ist nicht hier."
            : new RegExp('Roth', 'i').test(answer)
                    ? "Der Vorname würde es tun."
                    : null,
    hints: [
      "Reimt sich auf Gabian"
    ]
  },
  {
    id: "zwe", question: "(⛊ Seite 2) Was ist heute passiert?",
    answerCorrect: (answer) => new RegExp('Antrag', 'i').test(answer) && theDate.value === "2022-08-03",
    answerHint: (answer) => new RegExp('Ring', 'i').test(answer)
            ? "Nah dran, bitte die Aktion benennen."
            : new RegExp('Antrag', 'i').test(answer) && theDate.value !== "2022-08-03"
                    ? "Die Antwort stimmt, aber das war nicht heute."
                    : null,
    hints: [
      "Was für ein Tag ist 'heute'?",
      "Was war am 3. August 2022?",
      "Es hat irgendwas mit einem Ring und einem Kniefall zu tun.",
      "Es reimt sich auf Eintrag."
    ]
  },
  {
    id: "dre", question: "(⛝ Seite 3) Was hat sich versteckt?",
    answerCorrect: (answer) => new RegExp('Nice', 'i').test(answer),
    answerHint: (answer) => new RegExp('Kat', 'i').test(answer) || new RegExp('Mäxchen', 'i').test(answer)
            ? "Der Kater ist nicht versteckt."
            : new RegExp('1001110', 'i').test(answer)
                    ? "Das ist tatsächlich eine Seriennummer."
                    : new RegExp('78', 'i').test(answer)
                            ? "Das sind Zahlen, schön, aber was bedeuten sie?"
                            : null,
    hints: [
      "Wir suchen eine besondere Nummer auf dieser Seite.",
      "Die Nummer ist unter dem Nokia-Handy.",
      "Die Nummer ist irgendwie codiert.",
      "Die Nummer ist mit der Ascii-Tabelle codiert.",
      "Ascii hat 7 Bits. 1001110 ist die Dezimalzahl 105 und der Buchstabe N.",
    ]
  },
  {
    id: "vief", question: "(⛬ Seite 4) Was ist die Nachricht?",
    answerCorrect: (answer) => new RegExp('Dösebacka', 'i').test(answer),
    answerHint: (answer) => new RegExp('Doesebacka', 'i').test(answer)
            ? "Bitte ohne Umlaut."
            : new RegExp('36663377773322', 'i').test(answer)
                    ? "Geht in die richtige Richtung. Doch was bedeuten diese Zahlen?"
                    : null,
    hints: [
      "Irgendwo auf dieser Seite hat sich wieder etwas versteckt.",
      "Der gekennzeichnete Download auf dieser Seite ist nicht mehr grau.",
      "Schau dir mal die ID des gekennzeichneten Downloads an.",
      "Wenn du in der Vergangenheit dieses Escape-Spiels schaust, kannst du den Code dann entschlüsseln?",
      "Auf der vorigen Seite gibt es ein Nokia-Handy. Was kommt raus, wenn du die Nummer auf der Tastatur eintippst?",
    ]
  },
  {
    id: "fuef", question: "(⛾ Seite 5) Was ist der Ratschlag?",
    answerCorrect: (answer) => new RegExp('Weglaufen', 'i').test(answer),
    answerHint: (answer) => new RegExp('Surströmming', 'i').test(answer)
            ? "Wir haben tatsächlich vergorenen Hering probiert. Was hätten wir anders machen können?"
            : new RegExp('6396197', 'i').test(answer)
                    ? "Geil, eine Telefonnumer! Ist aber leider nicht die Antwort."
                    : null,
    hints: [
      "Was kann man tun, wenn ein Artikel Fehler aufweist?",
      "Errata=Fehler, Zeitungen bieten immer eine Möglichkeit wie man die Redaktion auf Fehler aufmerksam machen kann.",
      "Auf dieser Seite ist die Telefonnummer der Redaktion.",
      "Am besten die Telefonnummer mal anrufen.",
    ]
  },
  {
    id: "sechse", question: "(★ Seite 6) Wie ist der Name?",
    answerCorrect: (answer) => new RegExp('Ich&Der Andere', 'i').test(answer),
    answerHint: (answer) => new RegExp('Andere', 'i').test(answer)
            ? "Nah dran, wie muss man das schreiben, damit es in die Kästchen reinpasst?"
            : null,
    hints: [
      "Die Werbung sieht irgendwie verdächtig aus.",
      "Vielleicht hat jemand im Feld der Werbung etwas gekritzelt?",
      "Da gabs doch so einen Trick mit dem Bleistift wie man etwas wieder sichtbar machen kann.",
    ]
  },
  {
    id: "sibbe", question: "(☨ Seite 7) Wer war der eigentliche Star des Films?",
    answerCorrect: (answer) => new RegExp('Prof Brumm', 'i').test(answer),
    answerHint: (answer) => new RegExp('Pauline', 'i').test(answer)
            ? "Definitiv. Bei Requisiten und sogar vor der Kamera. Aber jetzt noch etwas glorreicher bitte."
            : new RegExp('Eltern', 'i').test(answer) || new RegExp('Helena', 'i').test(answer) || new RegExp('Dietrich', 'i').test(answer)
                    ? "Eltern unterstützen immer. Nicht die gesuchte antwort, aber schön, dass du an sie denkst."
                    : new RegExp('Richard', 'i').test(answer)
                    || new RegExp('Patrick', 'i').test(answer)
                    || new RegExp('Jenny', 'i').test(answer)
                    || new RegExp('Daniel', 'i').test(answer)
                            ? "Na klar."
                            : null,
    hints: [
      "Was ist denn die deutsche Version von Olymp und Hades?",
      "Himmel (Olymp) und Hölle (Hades) verlangt nach Falterei.",
      "Nach dem Falten entstehen kleine Bereiche zwischen den Falten. In diesen Bereichen gibt es schwarze Buchsteiben",
      "Was passiert wenn wir pro Bereich die Buchstaben aufsteigend verbinden?",
    ]
  },
  {
    id: "achte", question: "(♁ Seite 8) Was ist die Lösung?",
    answerCorrect: (answer) => new RegExp('KAS N5!', 'i').test(answer),
    hints: [
      "Der Kompass hat eine dunkle und eine Helle Seite. Welche sollen wir beachten?",
      "Wir sollen auf dieser Seite nur die Yin-Pfeile nach rechts und unten des Kompass beachten. Wo hilft uns das?",
      "Was passiert, wenn wir im Kreuzworträtsel nur die Felder schwärzen auf die ein Pfeil nach rechts oder unten zeigt?",
    ]
  },
  {
    id: "neunz", question: "(♔ Seite 9) Was haben wir außerdem in der WG gemacht?",
    answerCorrect: (answer) => new RegExp('Sushi zocken', 'i').test(answer),
    answerHint: (answer) => new RegExp('z0ck3n', 'i').test(answer)
            ? "Klingt leet, wie kann man das noch schreiben?"
            : null,
    hints: [
      "Lachs + Reis + Algen = ?",
      "z0ck3n ist 1337-Speak. Wie kann man das noch schreiben",
      "Wenn wir beide Wörter zusammenlegen ergibt das?",
    ]
  },
  {
    id: "zenz", question: "(★ Seite 10) Was ist die Antwort?",
    answerCorrect: (answer) => new RegExp('Chefsache', 'i').test(answer),
    answerHint: (answer) => new RegExp('Chefesache', 'i').test(answer)
            ? "Das ist jetzt aber schon eher umgangssprachlich..."
            : null,
    hints: [
      "Kucke mal da, auf dieser Seite gibt es Noten.",
      "Noten kann man singen, aber was passiert, wenn man die Noten aufschreibt?",
    ]
  },
  {
    id: "zwelfz", question: "(♠ Seite 12) Was ist angeordnet?",
    answerCorrect: (answer) => new RegExp('The Greatest Show', 'i').test(answer) &&  theDate.value === "2023-04-28",
    answerHint: (answer) => new RegExp('The Greatest Show', 'i').test(answer) && theDate.value !== "2023-04-28"
                    ? "Die Antwort stimmt, aber das ist nicht heute."
                    : null,
    hints: [
      "Manche der Sendungen sind schwarz markiert.",
      "Kannst du alles Schwarze in eine Reihenfolge bekommen?",
      "Oh This is ...?",
      "Wie heißt das Lied?",
    ]
  },
  {
    id: "dreiz", question: "(♨ Seite 13) Wie glücklich bist du?",
    answerCorrect: (answer) => new RegExp('[^_^]', 'i').test(answer),
    answerHint: (answer) => new RegExp('Sehr', 'i').test(answer) || new RegExp('Mega', 'i').test(answer)
            ? "Glaub ich dir aber mit worten kann man das nicht so gut beschreiben."
            : null,
    hints: [
      "Schau mal in die Vergangenheit. Was steht auf den vorigen Blättern?",
      "Gibt es auf den Blättern irgendwelche Zahlen die das heutige Datum ausmachen?",
      "Das heutige Datum findest du oben rechts auf Seite 13.",
      "Kann man mit den römischen Zahlen das heutige Datum schreiben? Ohne Jahresangabe allerdings, wäre ein bisschen lang.",
      "Der Punkt hinter der II. ist kein Versehen",
      "Die römischen Zahlen die das heutige Datum ausmachen sind XX VI II.I V",
      "Neben den römischen Zahlen gibt es doch noch so kleine Zeichen, zB ^, kann man die zu einem Smiley kombinieren?",
    ]
  },
  {
    id: "dreizzwei", question: "(# Seite 13) Der Dialog der Dialoge ist?",
    answerCorrect: (answer) => new RegExp('willstemitmirgehn-ja', 'i').test(answer),
    answerHint: (answer) => new RegExp('aj-', 'i').test(answer)
            ? "Das ist doch kein Dialog! Wirkt irgendwie verkehrt herum."
            : null,
    hints: [
      "Schau mal in die Vergangenheit. Wie hat die Webseite denn auf deine Antworten reagiert?",
      "Wenn du die Lösungen eingetippt hast, hat sich die Adresszeile in deinem Browser verändert?",
      "Schau mal was hinter dem # im Browser steht. Was passiert wenn du das Ergebnis aufschreibst? Die Zeitung hat dir dafür extra Platz gelassen.",
      "Was passiert wenn du das jetzt alles rückwärts liest?",
    ]
  },
];



const title = document.querySelector("#title");
const suggestion = document.querySelector("#suggestion");
const reset = document.querySelector("#reset");

const theForm = document.querySelector("#theForm");
const question = document.querySelector("#question");
const answer = document.querySelector("#answer");
const error = document.querySelector("#error");
const submit = document.querySelector("#submit");
const progress = document.querySelector("#progress");

const theHint = document.querySelector("#theHint");
const hints = document.querySelector("#hints");

const theDate = document.querySelector("#theDate");


theForm.addEventListener("submit", function(e){
  e.preventDefault();

  checkAnswer();
});
reset.addEventListener("click", function(){ 
  resetVisibility();
  askQuestion(0);
});

function askQuestion(index){
  if(hasWon(index)){
    showProgress(index);
    showHasWon();
    return;
  }

  index = Math.max(0, index);

  showTitle(index);
  showProgress(index);

  const qa = data[index];

  question.innerHTML = qa.question;
  answer.value = "";
  renderHints(qa.hints)
  
  history.pushState(null, "", `#${qa.id}`);
}

function checkAnswer(){
  const currentQaIndex = currentQaIndexOrMinusOne();
  if(currentQaIndex === -1){
    console.warn("No current answer. Resetting");
    resetVisibility();
    askQuestion(0);
    return;
  }

  console.info(`Answering question with ${answer.value}`);
  const currentQa = data[currentQaIndex];
  if(currentQa.answerCorrect(answer.value)){
    error.innerHTML = "";
    askQuestion(currentQaIndex + 1);
  } else if(currentQa.answerHint != null && currentQa.answerHint(answer.value) != null){
    console.error(`Answer ${answer.value} is almost right`);
    error.innerHTML = currentQa.answerHint(answer.value);
  } else {
    console.error(`Answer ${answer.value} is wrong`);
    error.innerHTML = "Leider falsch";
  }
}

/**
 * @param {string[]} hintTexts - All the hints for this question
 */
function renderHints(hintTexts){
  theHint.innerHTML = "";
  hints.innerHTML = "";
  hintTexts.forEach((text, index) => {
    const hintButton = document.createElement("BUTTON");
    hintButton.appendChild(document.createTextNode(`Tipp ${index}`));
    hintButton.addEventListener("click", function(){ showHint(text) });

    hints.appendChild(hintButton);
    hints.appendChild(document.createElement("p"))
  })
}

/**
 * @param {string} hintText - The hint to show
 */
function showHint(hintText){
  console.info(`Showing hint text: ${hintText}`);
  theHint.innerHTML = hintText;
}



function currentQaIndexOrMinusOne(){
  const hash = window.location.hash.substr(1);
  
  return data.findIndex(it => it.id === hash);
}

function hasWon(index){
  return index >= data.length;
}

function showHasWon(){
    title.innerHTML = "Gewonnen! Der Code für das Schloss ist 123.";
    reset.style.visibility = "visible";

    submit.style.visibility = "hidden";
    hints.style.visibility = "hidden";
}

function showTitle(index){
  if(index === 0){
    title.innerHTML = "Hallihallo";
  } else { 
    title.innerHTML = "Hallo Fabian";
    suggestion.style.visibility = "visible";
  }
}

function showProgress(index) {
  progress.max = data.length;
  progress.value = index;
}

function resetVisibility(){
  reset.style.visibility = "hidden";
  suggestion.style.visibility = "hidden";
  submit.style.visibility = "visible";
  hints.style.visibility = "visible";
}

resetVisibility();
askQuestion(currentQaIndexOrMinusOne());

</script>

</body>
</html>
