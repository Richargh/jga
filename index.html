<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>title</title>
  
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
</head>

<body>

<!-- <header>
<nav>
</nav>
</header> -->

<main>
  <h1 id="title"></h1>
  <p id="suggestion">Es ist sinnvoll die Antworten zu notieren</p>
  
  <article>
    <progress id="progress" max="100" value="70">10</progress>
    
    <form id="theForm">
      <div class="form-example">
        <label id="question" for="name">Tmp</label>
        <input id="answer" type="text" placeholder="Antwort" required>
        <label id="error" style="color: red"></label>
      </div>
      <div class="form-example">
        <input id="submit" type="submit" value="Antworten">
      </div>
    </form>

    <section id="hints">
      <button id="requestHint1">Tipp 1</button>
      <button id="requestHint2">Tipp 2</button>
      <button id="requestHint3">Tipp 3</button>
    </section>
    <label id="hint"></label>
  </article>


  <button id="reset">Alles zur√ºcksetzen</button>


</main>

<!-- <footer>
</footer> -->


<script>
const data = [
  {
    id: "start", question: "Willst du ein Spiel spielen?", 
    answerCorrect: () => new RegExp('ja', 'i').test(answer.value),
    hints: [
      "Ons", 
      "Zwe", 
      "Dre"
    ]
  },
  {
    id: "foo", question: "Seite 1: bar", answer: "bono", 
    answerCorrect: () => new RegExp('zwo', 'i').test(answer.value),
    hints: [
      "Foo", 
      "Boo", 
      "Doo"
    ]
  },
  {
    id: "bim", question: "Seite 2: benno", answer: "banjo", 
    answerCorrect: () => new RegExp('drei', 'i').test(answer.value),
    hints: [
      "1", 
      "2", 
      "3"
    ]
  },
];



const title = document.querySelector("#title");
const suggestion = document.querySelector("#suggestion");
const reset = document.querySelector("#reset");

const theForm = document.querySelector("#theForm");
const question = document.querySelector("#question");
const answer = document.querySelector("#answer");
const error = document.querySelector("#error");
const submit = document.querySelector("#submit");
const progress = document.querySelector("#progress");

const requestHint1 = document.querySelector("#requestHint1");
const requestHint2 = document.querySelector("#requestHint2");
const requestHint3 = document.querySelector("#requestHint3");
const hint = document.querySelector("#hint");


theForm.addEventListener("submit", function(e){
  e.preventDefault();

  checkAnswer();
});
reset.addEventListener("click", function(){ 
  resetVisibility();
  askQuestion(0);
}); 
requestHint1.addEventListener("click", function(){ showHint(0) });
requestHint2.addEventListener("click", function(){ showHint(1) });
requestHint3.addEventListener("click", function(){ showHint(2) });






function askQuestion(index){
  if(hasWon(index)){
    showProgress(index);
    showHasWon();
    return;
  }

  index = Math.max(0, index);

  showTitle(index);
  showProgress(index);

  const qa = data[index];

  question.innerHTML = qa.question;
  answer.value = "";
  hint.innerHTML = "";
  
  history.pushState(null, "", `#${qa.id}`);
}

function checkAnswer(){
  const currentQaIndex = currentQaIndexOrMinusOne();
  if(currentQaIndex === -1){
    console.warn("No current answer. Resetting");
    resetVisibility();
    askQuestion(0);
    return;
  }

  console.info(`Answering question with ${answer.value}`);
  const currentQa = data[currentQaIndex];
  if(currentQa.answerCorrect()){
    error.innerHTML = "";
    askQuestion(currentQaIndex + 1);
  } else {
    console.error(`Answer ${answer.value} is wrong`);
    error.innerHTML = "Leider falsch";
  }
}

function showHint(hintIndex){
  const currentQaIndex = currentQaIndexOrMinusOne();
  if(currentQaIndex === -1){
    console.warn("No current answer. Resetting");
    askQuestion(0);
    return;
  }
  console.info(`Requesting hint ${hintIndex}`);
  const currentQa = data[currentQaIndex];
  if(hintIndex >= currentQa.hints.length){
    hint.innerHTML = "Dieser Tipp existiert nicht";
  } else {
    const hintText = currentQa.hints[hintIndex];
    hint.innerHTML = hintText;
  }
}



function currentQaIndexOrMinusOne(){
  const hash = window.location.hash.substr(1);
  
  return data.findIndex(it => it.id === hash);
}

function hasWon(index){
  return index >= data.length;
}

function showHasWon(){
    title.innerHTML = "Gewonnen!";
    reset.style.visibility = "visible";

    submit.style.visibility = "hidden";
    hints.style.visibility = "hidden";
}

function showTitle(index){
  if(index === 0){
    title.innerHTML = "Hallihallo";
  } else { 
    title.innerHTML = "Hallo Fabian";
    suggestion.style.visibility = "visible";
  }
}

function showProgress(index) {
  progress.max = data.length;
  progress.value = index;
}

function resetVisibility(){
  reset.style.visibility = "hidden";
  suggestion.style.visibility = "hidden";
  submit.style.visibility = "visible";
  hints.style.visibility = "visible";
}

resetVisibility();
askQuestion(currentQaIndexOrMinusOne());

</script>

</body>
</html>
