<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JGA</title>
  
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
  <style>
    .hints {
      display: flex;
      flex-wrap: wrap;
      flex-direction: row;
      gap: 5px;
    }
  </style>
</head>

<body>

<!-- <header>
<nav>
</nav>
</header> -->

<main>
  <h1 id="title"></h1>
  <p id="suggestion">Es ist sinnvoll die Antworten zu notieren</p>

  <img id="won" src="lock.jpeg">

  <article>
    <progress id="progress" max="100" value="70">10</progress>
    
    <form id="theForm">
      <div>
        <label id="question" for="answer">Tmp</label>
        <input id="answer" type="text" placeholder="Antwort" required>
        <label id="error" style="color: red"></label>
      </div>
      <div>
        <input id="submit" type="submit" value="Antworten">
      </div>
    </form>

    <form id="theMysteryForm" class="notice">
      <h4>Aktionen</h4>
      <p id="thingTracker"></p>
      <div>
        <input id="mysteryThing" type="text" placeholder="VERDÄCHTIGER | ORT | GEGENSTAND" required>
      </div>
      <div>
        <input id="doView" type="submit" value="ANSCHAUEN">
        <input id="doInterview" type="submit" value="BEFRAGEN">
        <input id="doExamine" type="submit" value="UNTERSUCHEN">
        <input id="doPower" type="submit" value="KRAFT">
      </div>
      <label id="mysteryAnswer"></label>
    </form>

    <section>
      <div id="hints" class="hints">
      </div>
      <label id="theHint" class="notice"></label>
    </section>
  </article>


  <button id="reset">Alles zurücksetzen</button>


</main>

<footer>
  <input type="date" id="theDate" value="2023-04-01">
</footer>


<script>
const data = [
  {
    id: "iw", question: "(⚑ Seite 1) Wie ist der Name?",
    answerCorrect: (answer) => new RegExp('Fabian', 'i').test(answer),
    answerHint: (answer) => new RegExp('Pauline', 'i').test(answer)
            ? "Die ist nicht hier."
            : new RegExp('Roth', 'i').test(answer)
                    ? "Der Vorname würde es tun."
                    : null,
    hints: [
      "Reimt sich auf Gabian"
    ]
  },
  {
    id: "ll", question: "(⛊ Seite 2) Was ist heute passiert?",
    answerCorrect: (answer) => new RegExp('Antrag', 'i').test(answer) && theDate.value === "2022-08-03",
    answerHint: (answer) => new RegExp('Ring', 'i').test(answer)
            ? "Nah dran, bitte die Aktion benennen."
            : new RegExp('Antrag', 'i').test(answer) && theDate.value !== "2022-08-03"
                    ? "Die Antwort stimmt, aber das war nicht heute."
                    : null,
    hints: [
      "Was für ein Tag ist 'heute'?",
      "Was war am 3. August 2022?",
      "Es hat irgendwas mit einem Ring und einem Kniefall zu tun.",
      "Es reimt sich auf Eintrag."
    ]
  },
  {
    id: "ts", question: "(⛝ Seite 3) Was hat sich versteckt?",
    answerCorrect: (answer) => new RegExp('Nice', 'i').test(answer),
    answerHint: (answer) => new RegExp('Kat', 'i').test(answer) || new RegExp('Mäxchen', 'i').test(answer)
            ? "Der Kater ist nicht versteckt."
            : new RegExp('1001110', 'i').test(answer)
                    ? "Das ist tatsächlich eine Seriennummer."
                    : new RegExp('78', 'i').test(answer)
                            ? "Das sind Zahlen, schön, aber was bedeuten sie?"
                            : null,
    hints: [
      "Wir suchen eine besondere Nummer auf dieser Seite.",
      "Die Nummer ist unter dem Nokia-Handy.",
      "Die Nummer ist irgendwie codiert.",
      "Die Nummer ist mit der Ascii-Tabelle codiert.",
      "Ascii hat 7 Bits. 1001110 ist die Dezimalzahl 105 und der Buchstabe N.",
    ]
  },
  {
    id: "me", question: "(⛬ Seite 4) Was ist die Nachricht?",
    answerCorrect: (answer) => new RegExp('Doesebacka', 'i').test(answer),
    answerHint: (answer) => new RegExp('Dösebacka', 'i').test(answer)
            ? "Bitte mit ausgeschriebenem Umlaut."
            : new RegExp('36663377773322', 'i').test(answer)
                    ? "Geht in die richtige Richtung. Doch was bedeuten diese Zahlen?"
                    : null,
    hints: [
      "Irgendwo auf dieser Seite hat sich wieder etwas versteckt.",
      "Der gekennzeichnete Download auf dieser Seite ist nicht mehr grau.",
      "Schau dir mal die ID des gekennzeichneten Downloads an.",
      "Wenn du in der Vergangenheit dieses Escape-Spiels schaust, kannst du den Code dann entschlüsseln?",
      "Auf der vorigen Seite gibt es ein Nokia-Handy. Was kommt raus, wenn du die Nummer auf der Tastatur eintippst?",
    ]
  },
  {
    id: "ti", question: "(⛾ Seite 5) Was ist der Ratschlag?",
    answerCorrect: (answer) => new RegExp('Weglaufen', 'i').test(answer),
    answerHint: (answer) => new RegExp('Surströmming', 'i').test(answer)
            ? "Wir haben tatsächlich vergorenen Hering probiert. Was hätten wir anders machen können?"
            : new RegExp('6396197', 'i').test(answer)
                    ? "Geil, eine Telefonnumer! Ist aber leider nicht die Antwort."
                    : null,
    hints: [
      "Was kann man tun, wenn ein Artikel Fehler aufweist?",
      "Errata=Fehler, Zeitungen bieten immer eine Möglichkeit wie man die Redaktion auf Fehler aufmerksam machen kann.",
      "Auf dieser Seite ist die Telefonnummer der Redaktion.",
      "Am besten die Telefonnummer mal anrufen.",
    ]
  },
  {
    id: "im", question: "(★ Seite 6) Wie ist der Name?",
    answerCorrect: (answer) => new RegExp('Ich&Der Andere', 'i').test(answer),
    answerHint: (answer) => new RegExp('Andere', 'i').test(answer)
            ? "Nah dran, wie muss man das schreiben, damit es in die Kästchen reinpasst?"
            : null,
    hints: [
      "Die Werbung sieht irgendwie verdächtig aus.",
      "Vielleicht hat jemand im Feld der Werbung etwas gekritzelt?",
      "Da gabs doch so einen Trick mit dem Bleistift wie man etwas wieder sichtbar machen kann.",
    ]
  },
  {
    id: "gr", question: "(☨ Seite 7) Wer war der eigentliche Star des Films?",
    answerCorrect: (answer) => new RegExp('Prof Brumm', 'i').test(answer),
    answerHint: (answer) => new RegExp('Pauline', 'i').test(answer)
            ? "Definitiv. Bei Requisiten und sogar vor der Kamera. Aber jetzt noch etwas glorreicher bitte."
            : new RegExp('Eltern', 'i').test(answer) || new RegExp('Helena', 'i').test(answer) || new RegExp('Dietrich', 'i').test(answer)
                    ? "Eltern unterstützen immer. Nicht die gesuchte antwort, aber schön, dass du an sie denkst."
                    : new RegExp('Richard', 'i').test(answer)
                    || new RegExp('Patrick', 'i').test(answer)
                    || new RegExp('Jenny', 'i').test(answer)
                    || new RegExp('Daniel', 'i').test(answer)
                            ? "Waren super wichtig, sind aber nicht der eigentliche Star."
                            : null,
    hints: [
      "Himmel und Hölle verlangt nach Falterei.",
      "Nach dem Falten entstehen kleine Dreiecke, Kapitel, zwischen den Falten. In diesen Bereichen gibt es schwarze Buchsteiben.",
      "Was passiert wenn wir pro Dreieck die Buchstaben alphabetisch aufsteigend verbinden? Wir beginnen mit dem alphabetisch ersten Buchstaben (a oder b oder c oder ..) und malen eine Linie zum nächsten verfügbaren Buchstaben.",
    ]
  },
  {
    id: "he", question: "(♁ Seite 8) Was ist die Lösung?",
    answerCorrect: (answer) => new RegExp('KAS N5!', 'i').test(answer),
    answerHint: (answer) => new RegExp('NS!', 'i').test(answer)
            ? "Das 'S' ist eine Zahl. Nicht N'S', sondern ...?"
            : new RegExp('AS', 'i').test(answer) && !new RegExp('KAS', 'i').test(answer)
                    ? "Das vor dem 'AS' soll ein Buchstabe sein. Man braucht es für Vornamen die sich auf Onrad oder Evin reimen."
                    : new RegExp('KASN5!', 'i').test(answer)
                            ? "Fehlt irgendwie ein Leerzeichen..."
                            : null,
    hints: [
      "Der Kompass hat eine dunkle und eine Helle Seite. Welche sollen wir beachten?",
      "Wir sollen auf dieser Seite nur die Yin-Pfeile nach rechts und unten des Kompass beachten. Wo hilft uns das?",
      "Was passiert, wenn wir im Kreuzworträtsel nur die Felder schwärzen auf die ein Pfeil nach rechts oder unten zeigt?",
    ]
  },
  {
    id: "-n", question: "(♔ Seite 9) Was haben wir außerdem in der WG gemacht?",
    answerCorrect: (answer) => new RegExp('Sushi zocken', 'i').test(answer),
    answerHint: (answer) => new RegExp('z0ck3n', 'i').test(answer)
            ? "Klingt leet, wie kann man das noch schreiben?"
            : new RegExp('Sushizocken', 'i').test(answer)
                    ? "Bitte nicht einfach Wörter ausprobieren. Die Lösung passt genau in die Boxen auf der Zeitung."
                    : null,
    hints: [
      "Lachs + Reis + Algen = ?",
      "z0ck3n ist 1337-Speak. Wie kann man das noch schreiben",
      "Wenn wir beide Wörter zusammenlegen ergibt das?",
    ]
  },
  {
    id: "ua", question: "(★ Seite 10) Was ist die Kommunikation?",
    answerCorrect: (answer) => new RegExp('Chefsache', 'i').test(answer),
    answerHint: (answer) => new RegExp('Chefesache', 'i').test(answer)
            ? "Das ist jetzt aber schon eher umgangssprachlich..."
            : new RegExp('Chefeache', 'i').test(answer)
                    ? "Das ist kein Wort. Bitte korrekt kommunizieren."
                    : null,
    hints: [
      "Wo auf dieser Seite gibt es Musik?",
      "Wo auf dieser Seite gibt es denn Noten?",
      "Noten kann man singen, aber was passiert, wenn man die Noten aufschreibt?",
    ]
  },
  {
    id: "jf", question: "(♲ Seite 11) TÄTER MOTIV TATWAFFE ORT ZEIT?", isMystery: true,
    answerCorrect: (answer) => new RegExp('Sänger', 'i').test(answer) && new RegExp('Macht', 'i').test(answer)
            && new RegExp('Colt', 'i').test(answer) && new RegExp('03:48', 'i').test(answer) && new RegExp('Suite', 'i').test(answer),
    hints: [
      "Kennst du schon das Geheimnis des Spiegels?",
      "Hast du schon KRAFT auf den Spiegel angewandt? Weißt du schon wie der Spiegel den Riss bekommen hat und was es mit der Uhrzeit auf sich hat?",
      "Im Spiegel ist eine Uhr, doch welche Uhrzeit zeigt sie tatsächlich an? Welches Datum ist heute?",
      "Die Zeitung sagt heute ist der 28.3.1982. Zeitumstellung. Die Uhrzeit im Spiegel ist also plus eine Stunde. Die Uhr ist zusammen mit Spiegel kaputtgegangen als der Drummer von der Kugel dagegengeschleudert wurde.",
      "Kennst du schon das Knäul? Hast du mal KRAFT darauf angewandt?",
      "Kennst du schon den Zusammenhang zwischen KASSETTE, KASSETTENKOFFER, ARZTBERICHT und SHRILLRIDE?",
      "Die Band Shrillride, bekannt durch ihre schrillen Schreie, kann diese derzeit nur per Playback anbieten. Der Gitarrist hat das seinem Liebhaber, dem Drummer, erzählt. Letzterer möchte gerne selber singen und hat eine der Playback-Kassetten vom Gitarristen entwendet.",
      "Vorletzter Tipp.",
      "Der Sänger, Aushängeschild von Shrillride, ",
    ]
  },
  {
    id: "de", question: "(♠ Seite 12) Was ist angeordnet?",
    answerCorrect: (answer) => new RegExp('The Greatest Show', 'i').test(answer) &&  theDate.value === "2023-04-28",
    answerHint: (answer) => new RegExp('The Greatest Show', 'i').test(answer) && theDate.value !== "2023-04-28"
                    ? "Die Antwort stimmt, aber das ist nicht heute."
                    : null,
    hints: [
      "Manche der Sendungen sind schwarz markiert.",
      "Kannst du alles Schwarze in eine Reihenfolge bekommen?",
      "Oh This is ...?",
      "Wie heißt das Lied?",
    ]
  },
  {
    id: "ne", question: "(♨ Seite 13) Wie glücklich bist du?",
    answerCorrect: (answer) => answer.includes('[^_^]') || answer.includes('[^-^]'),
    answerHint: (answer) => new RegExp('Sehr', 'i').test(answer) || new RegExp('Mega', 'i').test(answer)
            ? "Glaub ich dir aber mit Worten aber kannst du das auch mit Zeichen beschreiben?"
            : null,
    hints: [
      "Schau mal in die Vergangenheit. Was steht auf den vorigen Blättern?",
      "Gibt es auf den Blättern irgendwelche Zahlen die das heutige Datum ausmachen?",
      "Das heutige Datum findest du oben rechts auf Seite 13.",
      "Kann man mit den römischen Zahlen das heutige Datum schreiben? Ohne Jahresangabe allerdings, wäre ein bisschen lang.",
      "Der Punkt hinter der II. ist kein Versehen",
      "Die römischen Zahlen die das heutige Datum ausmachen sind XX VI II.I V",
      "Neben den römischen Zahlen gibt es doch noch so kleine Zeichen, zB ^, kann man die zu einem Smiley kombinieren?",
    ]
  },
  {
    id: "finished", question: "(# Seite 13) Der Dialog der Dialoge ist?",
    answerCorrect: (answer) => new RegExp('willstemitmirgehn-aufjeden', 'i').test(answer),
    answerHint: (answer) => new RegExp('aj-', 'i').test(answer)
            ? "Das ist doch kein Dialog! Wirkt irgendwie verkehrt herum."
            : null,
    hints: [
      "Schau mal in die Vergangenheit. Wie hat die Webseite denn auf deine Antworten reagiert?",
      "Wenn du die Lösungen eingetippt hast, hat sich die Adresszeile in deinem Browser verändert?",
      "Schau mal was hinter dem # im Browser steht. Was passiert wenn du das Ergebnis aufschreibst? Die Zeitung hat dir dafür extra Platz gelassen.",
      "Was passiert wenn du das jetzt alles rückwärts liest?",
    ]
  },
];


const viewAction = 'view';
const examineAction = 'examine';
const interviewAction = 'interview';
const powerAction = 'power';

// Suspects
const mDrummer = 'DRUMMER';
const mKugel = 'KUGEL';
const mYin = 'YIN-HALSKETTE';

const mBassist = 'BASSIST';
const mBeretta = 'BERETTA';

const mGitarrist = 'GITARRIST';

const mSaenger = 'SÄNGER';

// Locations
const mBalkon = 'BALKON';
const mMuelleimer = 'MÜLLEIMER';
const mGummihandschuhe = 'GUMMIHANDSCHUHE';
const mColt = 'COLT';

const mFlur = 'FLUR';

const mStudio = 'STUDIO';
const mKassette = 'KASSETTE';

const mJsuite = 'JSUITE';
const mTagebuch = 'TAGEBUCH';

const mSuite = 'SUITE';
const mSpiegel = 'SPIEGEL';
const mKnaeul = 'KNÄUL';
const mArztBrief = 'ARZTBRIEF';
const mYang = 'YANG-HALSKETTE';

const mMaisonette = 'MAISONETTE';
const mZeitung = 'ZEITUNG';
const mKassettenKoffer = 'KASSETTENKOFFER';

const mysteries = [
        // DRUMMER
        {
          thing: mDrummer,
          actions: new Map([
            [viewAction, `Ein Muskelberg dessen Muskeln auch Muskeln haben. Wirkt sehr tod.`],
            [interviewAction, `Du überlegst dein Ouija-Board zu nutzen, entscheidest dich aber dagegen. Die Leute sind noch nicht bereit dafür.`],
            [examineAction, `Er trägt eine ${link(mYin)}. Eine ${link(mKugel)} steckt in seiner Brust. Todeszeitpunkt etwa 03:45.`],
            [powerAction, `Du schiebst ihn von der Tür weg. Man kann sie wieder normal öffnen. Unter ihm liegt nix.`],
          ])
        },
        {
          thing: mKugel,
          actions: new Map([
            [viewAction, `Die ${link(mKugel)} die den ${link(mDrummer)} umgebracht hat.`],
            [examineAction, `Die ${link(mKugel)} stammt aus einer Pistole.`],
            [powerAction, `Du drückst die ${link(mKugel)} mit aller Macht zusammen. Die ${link(mKugel)} ist mächtiger und verformt sich nicht.`],
          ])
        },
        {
          thing: mYin,
          actions: new Map([
            [viewAction, `Das schwarze Yin-Symbol von Yin&Yang. Etwas kitschig.`],
            [examineAction, `Scheint geteilt worden zu sein. Die Yang-Hälfte muss wo anders sein.`],
          ])
        },
        // BASSIST
        {
          thing: mBassist,
          actions: new Map([
            [viewAction, `Lange Dreadlocks und an seiner rechten Hand fehlt ein Finger. Er wirkt etwas benebelt und abwesend.`],
            [interviewAction, `Um 03:20 habe ich angefangen Mohrhun mit ${link(mSaenger)} zu spielen. Ich wollte ihn aufmuntern, er wollte aber nicht auf 'blöde Hühner' schießen. Um 03:40 ist ${link(mSaenger)} dann gegangen. Als mir vielleicht 15 Minuten später langweilig wurde habe ich bei ${link(mDrummer)} geklopft. Als er nicht antwortete bin ich reingegangen und habe seine Leiche gefunden und aufgeschrien. Das muss gegen 04:00 gewesen sein.`],
            [examineAction, `Seine Arme sind tätowiert mit weißen Tauben. Neben allerhand Drogen die er am und im Körper hat, ist sein ganzer Körper von oben bis unten auch voller Schießpulver. Er hat kürzlich diverse Schusswaffen abgefeurt. Eine ${link(mBeretta)} trägt er noch bei sich.`],
            [powerAction, `Du willst ihn schubsen, doch er weicht dir aus. Oder vielleicht ist er aus dem Weg getorckelt. Du bist dir nicht ganz sicher.`],
          ])
        },
        {
          thing: mBeretta,
          actions: new Map([
            [viewAction, `Eine Beretta 92.`],
            [examineAction, `Die Kugeln ähneln nicht der Kugel im Opfer. Diese Pistole hat ihn nicht getötet.`],
          ])
        },
        // GITARRIST
        {
          thing: mGitarrist,
          actions: new Map([
            [viewAction, `Spargel auf zwei Beinen.`],
            [interviewAction, `Ich war in meinem Bett. Geschlafen habe ich nicht, dafür hat ${link(mBassist)} viel zu viel geballert. Um 03:45 habe ich ${link(mDrummer)} noch in seinem ${link(mStudio)} gesehen. Danach habe ich auf den ${link(mBalkon)} eine, vielleicht zwei Kippen geraucht. Kurz darauf kam ${link(mSaenger)} zu mir und hat mitgeraucht. Als ${link(mBassist)} schrie bin ich sofort losgerannt um ihm zu helfen.`],
            [examineAction, `Er hat eine leere Zigarettenschachtel bei sich. Sonst hat er nichts an außer seinem Morgenmantel. Stinkt nach allem möglichen. Auch qualm.`],
            [powerAction, `Du schubst ihn um, er gibt klein bei und steht wieder auf.`],
          ])
        },
        // SAENGER
        {
          thing: mSaenger,
          actions: new Map([
            [viewAction, `Seine Wampe könnte davon profitieren mal etwas Sport zu machen. Die Krone auf seinem Kopf wirkt doch etwas dekadent.`],
            [interviewAction, `Um 03:20 habe ich das Zimmer von ${link(mBassist)} betreten und gegen 03:40 habe ich es wieder verlassen. ${link(mBassist)} hat die ganze Zeit geballert und der Alkohol ist nicht gut genug um die Langeweile zu überbrücken. Danach bin ich auf den Balkon zu ${link(mGitarrist)} gegangen. Als ${link(mBassist)} schrie bin ich sofort mitgekommen, um ihm zu helfen. Wir wahren etwa um 04:10 bei ihm.`],
            [examineAction, `Stinkt wie eine Gosse auf zwei Beinen. Der Körper ist voller Schießpulver.`],
            [powerAction, `Du schubst ihn, er fällt zu Boden und schreit auf. Naja eher ein Krächzen als ein Schrei aber begeistert ist er nicht. Er steht auf, richtet seine Krone und blickt dich drohend an.`],
          ])
        },

        /// RÄUME
        // FLUR
        {
          thing: mFlur,
          actions: new Map([
            [viewAction, `Ein Flur. Von ihm aus gehen Türen zum ${link(mBalkon)}, ${link(mStudio)}, ${link(mJsuite)}, ${link(mSuite)} und ${link(mMaisonette)}.`],
            [examineAction, `Du findest nichts Erwähnenwertes.`],
          ])
        },
  // BALKON
  {
    thing: mBalkon,
    actions: new Map([
      [viewAction, `Ein Hotelbalkon mit Ausblick auf die Stadt. Die gesamte Stadt. Du warst noch nie so hoch oben.`],
      [examineAction, `Du findest zwei Kippen auf dem Boden und einen ${link(mMuelleimer)}.`],
    ])
  },
  {
    thing: mMuelleimer,
    actions: new Map([
      [viewAction, `Der Mülleimer auf dem ${link(mBalkon)}. Aus Marmor. Warum auch nicht.`],
      [examineAction, `Du findest einen ${link(mColt)} und ein paar ${link(mGummihandschuhe)}`],
    ])
  },
  {
    thing: mGummihandschuhe,
    actions: new Map([
      [viewAction, `Dreckige ${link(mGummihandschuhe)}. Etwas in dir fleht dich an, dass du sie nicht untersuchen sollst. `],
      [examineAction, `Sperma! Die ${link(mGummihandschuhe)} sind voller Sperma. Natürlich musste es eklig sein. Außerdem noch Schießpulver. Da sich die Handschuhe um den ${link(mColt)} gewickelt haben ist nicht klar, ob das Pulver von der Waffe abgefärbt hat oder die Handschuhe zum Feuern der Waffe genutzt wurden.`],
      [powerAction, `Nein. Zu eklig auch nur eine Sekunde länger anzufassen.`],
    ])
  },
  {
    thing: mColt,
    actions: new Map([
      [viewAction, `Eine COLT 1911 Pistole.`],
      [examineAction, `Die Pistole wurde kürzlich gefeuert. Die ${link(mKugel)} steckt eindeutig im Körper von ${link(mDrummer)}. Auf der Waffe sind die Fingerabdrücke aller Bandmitglieder.`],
    ])
  },

  // STUDIO
  {
    thing: mStudio,
    actions: new Map([
      [viewAction, `Das Zimmer vom ${link(mDrummer)}. Kleiner als die anderen drei Zimmer. Vollgestellt mit Fitnessgeräten. Zwei Türen führen in das Zimmer rein. Die linke Tür, die nahe dem ${link(mBalkon)}, ist von der Leiche vom ${link(mDrummer)} blockiert. `],
      [examineAction, `In einem großen Wandschrank findest du diverse Pokale. Anscheinend war dieser Drummer mal Bass in einer A cappella Gruppe, PENTA-irgendwas. In einem der Pokale findest du eine ${link(mKassette)} mit der Aufschrift "finaler Schrei".`],
    ])
  },
  {
    thing: mKassette,
    actions: new Map([
      [viewAction, `Die ${link(mKassette)} aus dem ${link(mStudio)} vom ${link(mDrummer)}.`],
      [examineAction, `Du spielst die ${link(mKassette)} ab und hörst den Gesang von ${link(mSaenger)}, keine Instrumente. Die ${link(mKassette)} endet mit einen schrillen Schrei.`],
    ])
  },

  // JSUITE
  {
    thing: mJsuite,
    actions: new Map([
      [viewAction, `Die Junior Suite vom ${link(mBassist)}en. Das zweitkleinste Zimmer. Die Wand gegenüber von der Tür ist voller Einschusslöcher. Ein Beamer projeziert das Spiel Mohrhuhn auf die Wand. Die Wand rechts von der Tür ist voller Waffen. Unter dem Bett ist ein ${link(mTagebuch)}.`],
      [examineAction, `Die Einschusslöcher sind von unterschiedlichen Waffen. Es kostet dich viel zu viel Zeit aber du holst alle Kugeln aus der Wand und untersuchst zu welchen Waffen sie gehören. Ein paar der Kugeln kannst du keine Waffen zuordnen. Insgesamt fehlen an der Wand zwei Waffen, vermutlich Pistolen.`],
    ])
  },
  {
    thing: mTagebuch,
    actions: new Map([
      [viewAction, `Das ${link(mTagebuch)} vom ${link(mBassist)}en.`],
      [examineAction, `Viele Einträge mit Noten. D, D, D, D, E, E, D, D, D, ... Danach eine Seite in der sich ${link(mBassist)} darüber aufregt, dass sie die Tour pausieren. Mehrere Seiten sind vollgeschrieben von "All work and no play makes Jack a dull boy". Danach kein Eintrag mehr.`],
    ])
  },

  // SUITE
  {
    thing: mSuite,
    actions: new Map([
      [viewAction, `Die Suite des ${link(mGitarrist)}en. Eine Goldene Schallplatte schmückt eine Wand, eine goldene Liebesschaukel hängt im Raum und der Betthimmel leuchtet auch golden. Einzig der Wandhohe ${link(mSpiegel)} im Raum passt nicht zum sonstigen Schick im Raum, da er einen sehr unschönen und großen Riss vorweist.`],
      [examineAction, `Sowohl Liebesschaukel wie Bett wurden kürzlich benutzt. Immer diese notgeilen Musiker. Auf dem Nachttisch neben dem Bett findest du ein ${link(mKnaeul)} Papier und eine ${link(mYang)}.`],
    ])
  },
  {
    thing: mSpiegel,
    actions: new Map([
      [viewAction, `Ein Spiegel. Ein Riss geht quer durch. Eine analoge Uhr ist in den Spiegel eingelassen und um 02:48 stehngeblieben.`],
      [examineAction, `Der Riss im Spiegel scheint durch ein melonengroßes Objekt verursacht worden zu sein.`],
      [powerAction, `Du stemmst dich mit aller Macht gegen den Spiegel. Der Spiegel schwingt auf und du blickst genau auf die Leiche vom ${link(mDrummer)} im ${link(mStudio)}.`],
    ])
  },
  {
    thing: mKnaeul,
    actions: new Map([
      [viewAction, `Ein mit Kraft zusammengeknäultes Stück Papier.`],
      [powerAction, `Du wendest all deine Kraft an das Papier wieder zu entknäulen. Du findest einen Teil eines ${link(mArztBrief)}.`],
    ])
  },
  {
    thing: mArztBrief,
    actions: new Map([
      [viewAction, `Der Brief von einem Arzt. Jemand hat die Seite zusammengeknüllt und danach wieder entfaltet. Der Bericht entschuldigt sich ausdrücklich für den langsamen Heilungsprozess und empfiehlt es ruhig anzugehen und zu warten.`],
      [examineAction, `Die Handschrift ist von einem echten Arzt. Kaum lesbar.`],
      [powerAction, `Du zerknäulst den Brief wieder. Warum weißt du nicht genau.`],
    ])
  },
  {
    thing: mYang,
    actions: new Map([
      [viewAction, `Das weiße Yang-Symbol von Yin&Yang. Etwas kitschig.`],
      [examineAction, `Scheint in zwei geteilt worden zu sein. Die andere Hälfte muss wo anders sein.`],
    ])
  },

  // MAISONETTE
  {
    thing: mMaisonette,
    actions: new Map([
      [viewAction, `Das Maisonette vom ${link(mSaenger)}. Geschirr und Möbel sind von Diamenten geschmückt. Echte? An den Wänden gibt es ein paar Platin-Schallplatten.`],
      [examineAction, `Es sind tatsächlich echte Diamanten. Im Schreibtisch vom ${link(mSaenger)} findest du eine ${link(mZeitung)}, im Wandschrank ein ${link(mKassettenKoffer)}.`],
    ])
  },
  {
    thing: mZeitung,
    actions: new Map([
      [viewAction, `Eine Musikerzeitung mit vielen Artikeln. Die Coverstory dreht sich um Shrillride.`],
      [examineAction, `Du liest ein bisschen über Shrillride. Die Coverstory dreht sich um die lange Freundschaft zwischen ${link(mSaenger)} und ${link(mGitarrist)}. "Wir erzählen uns alles, es gibt keine Geheimnisse". Beide freuen sich nach einer längeren Pause endlich wieder weiter touren zu können.`],
    ])
  },
  {
    thing: mKassettenKoffer,
    actions: new Map([
      [viewAction, `Ein Koffer voller Kassetten. Eine Kassette fehlt.`],
      [examineAction, `Alle Kassetten sind vollgespielt mit dem Gesang von ${link(mSaenger)}. Dir kommt kein Lied bekannt vor aber du bist auch kein Fan von Shrillride.`],
    ])
  },
];


const thingMemory = [];

const title = document.querySelector("#title");
const won = document.querySelector('#won');
const suggestion = document.querySelector("#suggestion");
const reset = document.querySelector("#reset");

const theForm = document.querySelector("#theForm");
const question = document.querySelector("#question");
const answer = document.querySelector("#answer");
const error = document.querySelector("#error");
const submit = document.querySelector("#submit");
const progress = document.querySelector("#progress");

const theHint = document.querySelector("#theHint");
const hints = document.querySelector("#hints");


const theMysteryForm = document.querySelector("#theMysteryForm");
const mysteryThing = document.querySelector("#mysteryThing");
const mysteryAnswer = document.querySelector("#mysteryAnswer");
const thingTracker = document.querySelector("#thingTracker");
const doView = document.querySelector("#doView");
const doExamine = document.querySelector("#doExamine");
const doInterview = document.querySelector("#doInterview");
const doPower = document.querySelector("#doPower");


const theDate = document.querySelector("#theDate");


theForm.addEventListener("submit", function(e){
  e.preventDefault();

  checkAnswer();
});
reset.addEventListener("click", function(){ 
  resetVisibility();
  askQuestion(0);
});

doView.addEventListener("click", function(){ answerMystery(mysteryThing.value, viewAction); });
doExamine.addEventListener("click", function(){ answerMystery(mysteryThing.value, examineAction); });
doInterview.addEventListener("click", function(){ answerMystery(mysteryThing.value, interviewAction); });
doPower.addEventListener("click", function(){ answerMystery(mysteryThing.value, powerAction); });

function askQuestion(index){
  if(hasWon(index)){
    showProgress(index);
    showHasWon();
    return;
  }

  index = Math.max(0, index);

  showTitle(index);
  showProgress(index);

  const qa = data[index];
  if(isMystery(qa)){
    showMystery();
  } else {
    hideMystery();
  }

  question.innerHTML = qa.question;
  answer.value = "";
  renderHints(qa.hints)
  
  history.pushState(null, "", `#${qa.id}`);
}

function checkAnswer(){
  const currentQaIndex = currentQaIndexOrMinusOne();
  if(currentQaIndex === -1){
    console.warn("No current answer. Resetting");
    resetVisibility();
    askQuestion(0);
    return;
  }

  console.info(`Answering question with ${answer.value}`);
  const currentQa = data[currentQaIndex];
  if(currentQa.answerCorrect(answer.value)){
    error.innerHTML = "";
    askQuestion(currentQaIndex + 1);
  } else if(currentQa.answerHint != null && currentQa.answerHint(answer.value) != null){
    console.error(`Answer ${answer.value} is almost right`);
    error.innerHTML = currentQa.answerHint(answer.value);
  } else {
    console.error(`Answer ${answer.value} is wrong`);
    error.innerHTML = "Leider falsch";
  }
}

/**
 * @param {string[]} hintTexts - All the hints for this question
 */
function renderHints(hintTexts){
  theHint.innerHTML = "";
  hints.innerHTML = "";
  hintTexts.forEach((text, index) => {
    const hintButton = document.createElement("BUTTON");
    hintButton.appendChild(document.createTextNode(`Tipp ${index}`));
    hintButton.addEventListener("click", function(){ showHint(text) });

    hints.appendChild(hintButton);
    hints.appendChild(document.createElement("p"))
  })
}

/**
 * @param {string} hintText - The hint to show
 */
function showHint(hintText){
  console.info(`Showing hint text: ${hintText}`);
  theHint.innerHTML = hintText;
}

function answerMystery(thing, action){
  mysteryAnswer.innerHTML = findMysteryAnswer(thing.trim(), action);
}

function findMysteryAnswer(thing, action){
  const regex = new RegExp(thing, 'i');
  const mystery = mysteries.find(it => regex.test(it.thing));
  if(mystery == null)
    return "Dieses Ding existiert nicht."

  addToThingMemory(thing);
  renderThingTracker();
  return mystery.actions.get(action) ?? "Das kannst du nicht.";
}

function addToThingMemory(thing){
  if(thingMemory.find(it => it === thing))
    return;

  thingMemory.unshift(thing);
  if(thingMemory.length > 5){
    thingMemory.pop();
  }
}

function renderThingTracker(){
  thingTracker.innerHTML = thingMemory.map(it => link(it)).join(' - ');
}

function currentQaIndexOrMinusOne(){
  const hash = window.location.hash.substr(1);
  
  return data.findIndex(it => it.id === hash);
}

function hasWon(index){
  return index >= data.length;
}

function isMystery(qa){
  return qa.isMystery ?? false;
}

function link(value){
  return `<b onclick='selectThing("${value}")'>${value}</b>`;
}

function selectThing(thing){
  mysteryThing.value = thing;
}

function showHasWon(){
    title.innerHTML = "Gewonnen! Der Code für das Schloss ist 2804.";
    won.style.display = "block";
    reset.style.display = "block";

    submit.style.display = "none";
    hints.style.visibility = "hidden";
}

function showTitle(index){
  if(index === 0){
    title.innerHTML = "Hallihallo";
  } else { 
    title.innerHTML = "Hallo Fabian";
    suggestion.style.display = "block";
  }
}

function showProgress(index) {
  progress.max = data.length;
  progress.value = index;
}

function showMystery(){
  theMysteryForm.style.display = "block";
}

function hideMystery(){
  theMysteryForm.style.display = "none";
}

function resetVisibility(){
  won.style.display = "none";
  reset.style.display = "none";
  suggestion.style.display = "none";
  submit.style.display = "block";
  hints.style.visibility = "visible";

  theMysteryForm.style.display = "none";
}

resetVisibility();
askQuestion(currentQaIndexOrMinusOne());

</script>

</body>
</html>
