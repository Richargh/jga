<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>title</title>
  
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
</head>

<body>

<!-- <header>
<nav>
</nav>
</header> -->

<main>
  <h1 id="title"></h1>
  <p id="suggestion">Es ist sinnvoll die Antworten zu notieren</p>
  
  <article>
    <progress id="progress" max="100" value="70">10</progress>
    
    <form id="theForm">
      <div class="form-example">
        <label id="question" for="name">Tmp</label>
        <input id="answer" type="text" placeholder="Antwort" required>
        <label id="error" style="color: red"></label>
      </div>
      <div class="form-example">
        <input id="submit" type="submit" value="Antworten">
      </div>
    </form>

    <section>
      <label id="theHint" class="notice"></label>
      <div id="hints">
      </div>
    </section>
  </article>


  <button id="reset">Alles zurücksetzen</button>


</main>

<!-- <footer>
</footer> -->


<script>
const data = [
  {
    id: "start", question: "(⚑) Wie ist der Name?",
    answerCorrect: (answer) => new RegExp('Fabian', 'i').test(answer),
    answerHint: (answer) => new RegExp('Pauline', 'i').test(answer)
            ? "Die ist nicht hier."
            : new RegExp('Roth', 'i').test(answer)
                    ? "Der Vorname würde es tun."
                    : null,
    hints: [
      "Reimt sich auf Gabian"
    ]
  },
  {
    id: "foo", question: "(⛊) Was ist heute passiert?",
    answerCorrect: (answer) => new RegExp('Antrag', 'i').test(answer),
    answerHint: (answer) => new RegExp('Ring', 'i').test(answer)
                          ? "Nah dran, bitte die Aktion benennen."
                          : null,
    hints: [
      "Was für ein Tag ist 'heute'?",
      "Was war am 3. August 2022?",
      "Es hat irgendwas mit einem Ring und einem Kniefall zu tun.",
      "Es reimt sich auf Eintrag."
    ]
  },
  {
    id: "bim", question: "(⛝) Was hat sich versteckt?",
    answerCorrect: (answer) => new RegExp('Nice', 'i').test(answer),
    answerHint: (answer) => new RegExp('Kat', 'i').test(answer) || new RegExp('Mäxchen', 'i').test(answer)
            ? "Der Kater ist nicht versteckt."
            : new RegExp('1001110', 'i').test(answer)
                    ? "Das ist tatsächlich eine Seriennummer."
                    : new RegExp('78', 'i').test(answer)
                            ? "Das sind Zahlen, schön, aber was bedeuten sie?"
                            : null,
    hints: [
      "Wir suchen eine besondere Nummer auf dieser Seite.",
      "Die Nummer ist unter dem Nokia-Handy.",
      "Die Nummer ist irgendwie codiert.",
      "Die Nummer ist mit der Ascii-Tabelle codiert.",
      "Ascii hat 7 Bits. 1001110 ist die Dezimalzahl 105 und der Buchstabe N.",
    ]
  },
];



const title = document.querySelector("#title");
const suggestion = document.querySelector("#suggestion");
const reset = document.querySelector("#reset");

const theForm = document.querySelector("#theForm");
const question = document.querySelector("#question");
const answer = document.querySelector("#answer");
const error = document.querySelector("#error");
const submit = document.querySelector("#submit");
const progress = document.querySelector("#progress");

const theHint = document.querySelector("#theHint");
const hints = document.querySelector("#hints");


theForm.addEventListener("submit", function(e){
  e.preventDefault();

  checkAnswer();
});
reset.addEventListener("click", function(){ 
  resetVisibility();
  askQuestion(0);
});

function askQuestion(index){
  if(hasWon(index)){
    showProgress(index);
    showHasWon();
    return;
  }

  index = Math.max(0, index);

  showTitle(index);
  showProgress(index);

  const qa = data[index];

  question.innerHTML = qa.question;
  answer.value = "";
  renderHints(qa.hints)
  
  history.pushState(null, "", `#${qa.id}`);
}

function checkAnswer(){
  const currentQaIndex = currentQaIndexOrMinusOne();
  if(currentQaIndex === -1){
    console.warn("No current answer. Resetting");
    resetVisibility();
    askQuestion(0);
    return;
  }

  console.info(`Answering question with ${answer.value}`);
  const currentQa = data[currentQaIndex];
  if(currentQa.answerCorrect(answer.value)){
    error.innerHTML = "";
    askQuestion(currentQaIndex + 1);
  } else if(currentQa.answerHint != null && currentQa.answerHint(answer.value) != null){
    console.error(`Answer ${answer.value} is almost right`);
    error.innerHTML = currentQa.answerHint(answer.value);
  } else {
    console.error(`Answer ${answer.value} is wrong`);
    error.innerHTML = "Leider falsch";
  }
}

/**
 * @param {string[]} hintTexts - All the hints for this question
 */
function renderHints(hintTexts){
  theHint.innerHTML = "";
  hints.innerHTML = "";
  hintTexts.forEach((text, index) => {
    const hintButton = document.createElement("BUTTON");
    hintButton.appendChild(document.createTextNode(`Tipp ${index}`));
    hintButton.addEventListener("click", function(){ showHint(text) });

    hints.appendChild(hintButton);
  })
}

/**
 * @param {string} hintText - The hint to show
 */
function showHint(hintText){
  console.info(`Showing hint text: ${hintText}`);
  theHint.innerHTML = hintText;
}



function currentQaIndexOrMinusOne(){
  const hash = window.location.hash.substr(1);
  
  return data.findIndex(it => it.id === hash);
}

function hasWon(index){
  return index >= data.length;
}

function showHasWon(){
    title.innerHTML = "Gewonnen!";
    reset.style.visibility = "visible";

    submit.style.visibility = "hidden";
    hints.style.visibility = "hidden";
}

function showTitle(index){
  if(index === 0){
    title.innerHTML = "Hallihallo";
  } else { 
    title.innerHTML = "Hallo Fabian";
    suggestion.style.visibility = "visible";
  }
}

function showProgress(index) {
  progress.max = data.length;
  progress.value = index;
}

function resetVisibility(){
  reset.style.visibility = "hidden";
  suggestion.style.visibility = "hidden";
  submit.style.visibility = "visible";
  hints.style.visibility = "visible";
}

resetVisibility();
askQuestion(currentQaIndexOrMinusOne());

</script>

</body>
</html>
